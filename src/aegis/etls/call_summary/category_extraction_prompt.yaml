# Category Extraction Prompt - Quality Optimized
# Enhanced for comprehensive, high-quality extraction with context awareness

tool:
  type: function
  function:
    name: extract_category_content
    description: Extracts comprehensive, high-quality content for each category
    parameters:
      type: object
      properties:
        rejected:
          type: boolean
          description: True if this category lacks sufficient material content
        rejection_reason:
          type: string
          description: Detailed explanation if rejected (required when rejected=true)
        title:
          type: string
          description: "Dynamic title that captures the essence of content found"
        summary_statements:
          type: array
          description: Comprehensive key findings with rich supporting evidence
          minItems: 3
          maxItems: 7
          items:
            type: object
            properties:
              statement:
                type: string
                description: Synthesized insight that captures a material theme or trend
              evidence:
                type: array
                description: Supporting quotes and context that enrich the statement
                minItems: 1
                maxItems: 4
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      enum: [quote, paraphrase]
                      description: Whether this is a direct quote or paraphrased content
                    content:
                      type: string
                      description: Evidence that adds depth, context, or nuance to the statement
                    speaker:
                      type: string
                      description: Speaker's name and title/role
                    context:
                      type: string
                      description: Optional context about when/why this was said
                  required: [type, content, speaker]
            required: [statement, evidence]
      required: [rejected]

system_template: |
  <context>
  You are extracting content for category {category_index} of {total_categories} in a comprehensive earnings call analysis.
  Bank: {bank_name} ({bank_symbol}) | Period: {quarter} {fiscal_year}
  This is a continuation of the report - do not reintroduce context.
  </context>
  
  <current_category>
  Name: {category_name}
  Requirements: {category_description}
  Source Section: {transcripts_section} section only
  </current_category>
  
  <research_guidance>
  Based on the research plan for this category:
  {research_plan}
  </research_guidance>
  
  <previous_categories_context>
  Categories already processed (avoid duplication):
  {previous_sections}
  
  Key themes already covered:
  {extracted_themes}
  </previous_categories_context>
  
  <extraction_framework>
  EVIDENCE SELECTION PRIORITIES (in order):
  1. Quantitative metrics with strategic context
     - Not just numbers, but what drives them
     - Year-over-year comparisons with explanations
     - Forward guidance with rationale
  
  2. Strategic initiatives and transformations
     - New programs or changes in approach
     - Investment priorities and resource allocation
     - Competitive positioning statements
  
  3. Management insights and forward outlook
     - CEO/CFO commentary on trends
     - Responses to analyst concerns
     - Risk mitigation strategies
  
  4. Market dynamics and external factors
     - Regulatory impacts and responses
     - Economic environment effects
     - Competitive landscape observations
  
  5. Operational performance indicators
     - Efficiency improvements
     - Technology implementations
     - Process optimizations
  
  EVIDENCE QUALITY STANDARDS:
  - Each piece of evidence must ADD VALUE beyond the statement
  - Prefer specific over generic content
  - Include context that explains the "why" behind metrics
  - Select quotes that provide color or unique perspective
  - Balance between prepared remarks and Q&A insights
  </extraction_framework>
  
  <synthesis_approach>
  For each summary statement:
  1. SYNTHESIZE: Combine related points into a cohesive insight
  2. SUBSTANTIATE: Support with evidence that adds depth
  3. CONTEXTUALIZE: Explain significance or implications
  4. DIFFERENTIATE: Ensure unique from other categories
  
  The relationship should be:
  - Statement = The "what" (synthesized finding)
  - Evidence = The "how/why/when" (context and color)
  </synthesis_approach>
  
  <quality_requirements>
  - Extract 3-7 MATERIAL insights (prefer depth over quantity)
  - Each statement must represent a significant finding
  - Evidence should illuminate, not just repeat
  - Maintain analytical objectivity
  - Focus on bank-specific insights over industry generalities
  - Ensure no redundancy with previously extracted content
  </quality_requirements>
  
  <rejection_criteria>
  Reject this category if:
  - Fewer than 3 material insights can be extracted
  - Content is predominantly generic or boilerplate
  - All substantial content already covered in other categories
  - Discussion lacks sufficient depth for meaningful analysis
  - No concrete information beyond passing mentions
  
  If rejecting, provide specific explanation referencing the actual content reviewed.
  </rejection_criteria>
  
  <response_format>
  Use the provided tool to return structured content.
  
  For accepted categories:
  - Create a dynamic title reflecting actual content
  - Provide 3-7 comprehensive summary statements
  - Support each with 1-4 pieces of enriching evidence
  - Ensure high quality over quantity
  
  For rejected categories:
  - Set rejected=true
  - Provide detailed rejection_reason explaining the specific content gaps
  </response_format>