# Category Extraction Prompt - Quality Optimized
# Enhanced for comprehensive, high-quality extraction with context awareness

tool:
  type: function
  function:
    name: extract_category_content
    description: Extracts comprehensive, high-quality content for each category
    parameters:
      type: object
      properties:
        rejected:
          type: boolean
          description: True if this category lacks sufficient material content
        rejection_reason:
          type: string
          description: Detailed explanation if rejected (required when rejected=true)
        title:
          type: string
          description: "Format: 'Category Name: Brief Context' (e.g., 'Expenses: Navigating workforce challenges' or 'Credit Quality: Resilient amid economic uncertainty'). Keep brief for TOC readability (max 60 chars total)"
        summary_statements:
          type: array
          description: Comprehensive key findings with rich supporting evidence
          minItems: 3
          maxItems: 7
          items:
            type: object
            properties:
              statement:
                type: string
                description: Synthesized insight that captures a material theme or trend
              evidence:
                type: array
                description: Supporting quotes and context that enrich the statement
                minItems: 1
                maxItems: 4
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      enum: [quote, paraphrase]
                      description: Whether this is a direct quote or paraphrased content
                    content:
                      type: string
                      description: Evidence that adds depth, context, or nuance to the statement
                    speaker:
                      type: string
                      description: Speaker's name and title/role
                    context:
                      type: string
                      description: Optional context about when/why this was said
                  required: [type, content, speaker]
            required: [statement, evidence]
      required: [rejected]

system_template: |
  <context>
  You are extracting content for category {category_index} of {total_categories} in a comprehensive earnings call analysis.
  Bank: {bank_name} ({bank_symbol}) | Period: {quarter} {fiscal_year}
  This is a continuation of the report - do not reintroduce context.
  </context>
  
  <current_category>
  Name: {category_name}
  Requirements: {category_description}
  Source Section: {transcripts_section} section only
  </current_category>
  
  <research_guidance>
  Based on the research plan for this category:
  {research_plan}
  </research_guidance>
  
  <previous_categories_context>
  Categories already processed (avoid duplication):
  {previous_sections}
  
  Key themes already covered:
  {extracted_themes}
  </previous_categories_context>
  
  <extraction_framework>
  METRIC EXTRACTION RULES:
  1. When reporting ANY metric, include ALL available variations:
     - Current period value
     - Year-over-year (YoY) change (amount and percentage)
     - Quarter-over-quarter (QoQ) change if mentioned
     - Year-to-date (YTD) figures if provided
     - Prior year comparisons
     - Any guidance or targets mentioned
  
  2. Each metric should have its OWN statement:
     - Don't combine multiple unrelated metrics in one statement
     - Group only closely related sub-metrics (e.g., NIM components)
     - Make the metric the focus of the statement
  
  3. Evidence selection for metrics:
     - DO NOT quote/paraphrase metrics already in the statement
     - ONLY add quotes that provide context BEYOND the numbers:
       * Management explanation of drivers
       * Strategic rationale for changes
       * Forward-looking commentary
       * Unusual factors or one-time items
     - Skip evidence if it merely restates the metric
  
  EVIDENCE SELECTION PRIORITIES (in order):
  1. Strategic initiatives and transformations
     - New programs or changes in approach
     - Investment priorities and resource allocation
     - Competitive positioning statements
  
  2. Management insights and forward outlook
     - CEO/CFO commentary on trends
     - Responses to analyst concerns
     - Risk mitigation strategies
  
  3. Market dynamics and external factors
     - Regulatory impacts and responses
     - Economic environment effects
     - Competitive landscape observations
  
  4. Operational performance indicators
     - Efficiency improvements
     - Technology implementations
     - Process optimizations
  
  EVIDENCE QUALITY STANDARDS:
  - Each piece of evidence must ADD CONTEXT beyond the statement
  - Never quote metrics that are already in the statement
  - Focus on the "why" and "how" rather than the "what"
  - Select quotes that provide color or unique perspective
  - Balance between prepared remarks and Q&A insights
  </extraction_framework>
  
  <synthesis_approach>
  For each summary statement:
  1. FOCUS: One primary metric or closely related metric group per statement
  2. COMPLETE: Include all available data points (current, YoY, QoQ, YTD)
  3. CONTEXTUALIZE: Evidence should explain drivers, not repeat numbers
  4. DIFFERENTIATE: Ensure unique from other categories
  
  The relationship should be:
  - Statement = Complete metric with all variations
  - Evidence = Context, drivers, and strategic rationale (NOT the numbers)
  </synthesis_approach>
  
  <quality_requirements>
  - Extract 3-7 MATERIAL insights (prefer depth over quantity)
  - Each statement must represent a significant finding
  - Evidence should illuminate, not just repeat
  - Maintain analytical objectivity
  - Focus on bank-specific insights over industry generalities
  - Ensure no redundancy with previously extracted content
  </quality_requirements>
  
  <rejection_criteria>
  Reject this category if:
  - Fewer than 3 material insights can be extracted
  - Content is predominantly generic or boilerplate
  - All substantial content already covered in other categories
  - Discussion lacks sufficient depth for meaningful analysis
  - No concrete information beyond passing mentions
  
  If rejecting, provide specific explanation referencing the actual content reviewed.
  </rejection_criteria>
  
  <response_format>
  Use the provided tool to return structured content.
  
  For accepted categories:
  - Title MUST start with category name followed by colon and brief context
    * Format: "Category Name: Brief descriptive context"
    * Example: "Financial Performance: Record revenue amid headwinds"
    * Keep total length under 60 characters for TOC readability
  - Provide 3-7 comprehensive summary statements
  - Support each with 1-4 pieces of enriching evidence
  - Ensure high quality over quantity
  
  For rejected categories:
  - Set rejected=true
  - Provide detailed rejection_reason explaining the specific content gaps
  </response_format>