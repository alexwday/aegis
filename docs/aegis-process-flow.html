<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aegis AI Financial Assistant - Process Flow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        nav {
            background: #f8f9fa;
            padding: 20px 40px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            border-bottom: 2px solid #e9ecef;
        }

        .nav-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .nav-btn:hover, .nav-btn.active {
            background: #667eea;
            color: white;
        }

        .content {
            padding: 40px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .flow-diagram {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .flow-step {
            background: white;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .flow-step::before {
            content: '';
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            border: 3px solid white;
        }

        .flow-step h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .flow-step p {
            color: #495057;
            line-height: 1.6;
        }

        .flow-step .details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .flow-step .details ul {
            list-style: none;
            padding-left: 0;
        }

        .flow-step .details li {
            padding: 5px 0;
            padding-left: 25px;
            position: relative;
        }

        .flow-step .details li::before {
            content: '‚Üí';
            position: absolute;
            left: 0;
            color: #764ba2;
            font-weight: bold;
        }

        .branch {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .branch-option {
            flex: 1;
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
        }

        .branch-option h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .agent-card {
            background: white;
            border: 2px solid #764ba2;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .agent-card h4 {
            color: #764ba2;
            margin-bottom: 8px;
        }

        .code-block {
            background: #2d3748;
            color: #48bb78;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 10px 0;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .metric-card h4 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .metric-card p {
            opacity: 0.9;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #667eea;
        }

        .timeline-item {
            position: relative;
            margin: 30px 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 12px;
            height: 12px;
            background: #667eea;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 3px #667eea;
        }

        .info-box {
            background: #e7f5ff;
            border-left: 4px solid #339af0;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Aegis AI Financial Assistant</h1>
            <div class="subtitle">Complete Process Flow Documentation</div>
        </header>

        <nav>
            <button class="nav-btn active" onclick="showSection('overview')">Overview</button>
            <button class="nav-btn" onclick="showSection('initialization')">Initialization</button>
            <button class="nav-btn" onclick="showSection('routing')">Routing Logic</button>
            <button class="nav-btn" onclick="showSection('research')">Research Workflow</button>
            <button class="nav-btn" onclick="showSection('direct')">Direct Response</button>
            <button class="nav-btn" onclick="showSection('etl')">ETL Mode</button>
            <button class="nav-btn" onclick="showSection('monitoring')">Monitoring</button>
            <button class="nav-btn" onclick="showSection('architecture')">Architecture</button>
        </nav>

        <div class="content">
            <!-- Overview Section -->
            <div class="section active" id="overview">
                <h2>System Overview</h2>

                <div class="info-box">
                    <strong>Purpose:</strong> Aegis is an AI-powered financial assistant for RBC's CFO Group that processes natural language queries about financial data, orchestrating multiple specialized agents to retrieve and synthesize information from various databases.
                </div>

                <div class="success-box">
                    <strong>Key Features:</strong>
                    <ul style="list-style: none; padding-left: 0;">
                        <li>‚úì Real-time streaming responses</li>
                        <li>‚úì Concurrent database retrieval</li>
                        <li>‚úì Intelligent query routing</li>
                        <li>‚úì ETL mode for batch processing</li>
                        <li>‚úì Comprehensive monitoring</li>
                        <li>‚úì Cost tracking and optimization</li>
                    </ul>
                </div>

                <div class="metrics">
                    <div class="metric-card">
                        <h4>5</h4>
                        <p>Core Agents</p>
                    </div>
                    <div class="metric-card">
                        <h4>4</h4>
                        <p>Database Subagents</p>
                    </div>
                    <div class="metric-card">
                        <h4>117</h4>
                        <p>Test Cases</p>
                    </div>
                    <div class="metric-card">
                        <h4>93%</h4>
                        <p>Code Coverage</p>
                    </div>
                </div>

                <div class="warning-box">
                    <strong>Database Pairing Rules:</strong>
                    <ul style="list-style: none; padding-left: 0;">
                        <li>‚Ä¢ <strong>Line items:</strong> benchmarking + RTS (always together)</li>
                        <li>‚Ä¢ <strong>Management commentary:</strong> transcripts only</li>
                        <li>‚Ä¢ <strong>Pre-generated reports:</strong> reports only</li>
                        <li>‚Ä¢ <strong>Official documents:</strong> RTS only (10-Q/10-K)</li>
                    </ul>
                </div>

                <div class="flow-diagram">
                    <h3>High-Level Process Flow</h3>

                    <div class="flow-step">
                        <h3>1. Request Reception</h3>
                        <p>User query arrives through web interface or API</p>
                        <div class="details">
                            <ul>
                                <li>Generate unique execution_id (UUID)</li>
                                <li>Initialize monitoring and tracking</li>
                                <li>Setup SSL and authentication</li>
                            </ul>
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>2. Query Analysis</h3>
                        <p>Router agent determines query type</p>
                        <div class="details">
                            <ul>
                                <li>Binary classification: direct vs research</li>
                                <li>Intent extraction and validation</li>
                                <li>Context preparation</li>
                            </ul>
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>3. Processing Path</h3>
                        <p>Execute appropriate workflow based on routing</p>
                        <div class="branch">
                            <div class="branch-option">
                                <h4>Direct Response Path</h4>
                                <p>For greetings, definitions, clarifications</p>
                            </div>
                            <div class="branch-option">
                                <h4>Research Workflow Path</h4>
                                <p>For data queries requiring database retrieval</p>
                            </div>
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>4. Response Generation</h3>
                        <p>Synthesize and stream response to user</p>
                        <div class="details">
                            <ul>
                                <li>Real-time streaming using generators</li>
                                <li>Multi-source synthesis for research queries</li>
                                <li>Error handling and graceful degradation</li>
                            </ul>
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>5. Completion & Monitoring</h3>
                        <p>Log metrics and clean up resources</p>
                        <div class="details">
                            <ul>
                                <li>Save execution metrics to database</li>
                                <li>Calculate tokens and costs</li>
                                <li>Release connections and resources</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Initialization Section -->
            <div class="section" id="initialization">
                <h2>Request Initialization Process</h2>
                
                <div class="flow-diagram">
                    <h3>Initialization Steps</h3>
                    
                    <div class="timeline">
                        <div class="timeline-item">
                            <h4>Generate Execution ID</h4>
                            <div class="code-block">
execution_id = str(uuid.uuid4())
logger.info(f"üöÄ Starting workflow: {execution_id}")
                            </div>
                        </div>

                        <div class="timeline-item">
                            <h4>Initialize Monitor</h4>
                            <div class="code-block">
initialize_monitor(execution_id, "aegis")
# Creates tracking entry in process_monitor_logs table
                            </div>
                        </div>

                        <div class="timeline-item">
                            <h4>Setup SSL Configuration</h4>
                            <div class="code-block">
ssl_config = setup_ssl()
# Returns: {"verify": bool, "cert_path": str|None}
                            </div>
                        </div>

                        <div class="timeline-item">
                            <h4>Configure Authentication</h4>
                            <div class="code-block">
auth_config = setup_authentication(execution_id, ssl_config)
# OAuth 2.0 or API key based on AUTH_METHOD
                            </div>
                        </div>

                        <div class="timeline-item">
                            <h4>Process Conversation</h4>
                            <div class="code-block">
processed = process_conversation(conversation)
# Validates, filters, and trims message history
                            </div>
                        </div>

                        <div class="timeline-item">
                            <h4>Load Database Filters</h4>
                            <div class="code-block">
available_databases = get_available_databases()
# Loads aegis_data_availability constraints
                            </div>
                        </div>

                        <div class="timeline-item">
                            <h4>Create Context Object</h4>
                            <div class="code-block">
context = {
    "execution_id": execution_id,
    "auth_config": auth_config,
    "ssl_config": ssl_config,
    "available_databases": available_databases
}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Note:</strong> All initialization steps include comprehensive error handling with fallback mechanisms to ensure system resilience.
                </div>
            </div>

            <!-- Routing Section -->
            <div class="section" id="routing">
                <h2>Query Routing Logic</h2>
                
                <div class="agent-card">
                    <h4>Router Agent</h4>
                    <p><strong>Purpose:</strong> Binary classification to determine processing path</p>
                    <p><strong>Model:</strong> Medium tier for balanced speed and accuracy</p>
                    <p><strong>Decision:</strong> "direct_response" or "research_workflow"</p>
                </div>

                <div class="flow-diagram">
                    <h3>Routing Decision Tree</h3>
                    
                    <div class="branch">
                        <div class="branch-option">
                            <h4>Direct Response Triggers</h4>
                            <ul style="list-style: none; padding: 10px 0;">
                                <li>‚úì Greetings and pleasantries</li>
                                <li>‚úì System capability questions</li>
                                <li>‚úì Definitions and explanations</li>
                                <li>‚úì Data reformatting requests</li>
                                <li>‚úì Clarification of previous responses</li>
                                <li>‚úì Non-financial queries</li>
                            </ul>
                        </div>
                        <div class="branch-option">
                            <h4>Research Workflow Triggers</h4>
                            <ul style="list-style: none; padding: 10px 0;">
                                <li>‚úì Specific metric requests</li>
                                <li>‚úì Bank performance data</li>
                                <li>‚úì Regulatory information</li>
                                <li>‚úì Earnings transcripts</li>
                                <li>‚úì Comparative analysis</li>
                                <li>‚úì Historical trends</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="code-block">
# Router Implementation
def route_query(conversation, latest_message, context):
    messages = [
        {"role": "system", "content": router_prompt},
        {"role": "user", "content": latest_message["content"]}
    ]
    
    response = complete_with_tools(messages, tools, context, model_tier="medium")
    
    if "direct" in response.lower():
        return "direct_response"
    else:
        return "research_workflow"
                </div>
            </div>

            <!-- Research Workflow Section -->
            <div class="section" id="research">
                <h2>Research Workflow Process</h2>
                
                <div class="flow-diagram">
                    <h3>Multi-Stage Research Pipeline</h3>
                    
                    <div class="flow-step">
                        <h3>Stage 1: Clarification</h3>
                        <p><strong>Agent:</strong> Clarifier | <strong>Model:</strong> Large tier for complex extraction</p>
                        <div class="details">
                            <ul>
                                <li>Extract bank entities from query</li>
                                <li>Identify time periods (quarters/years)</li>
                                <li>Determine query intent and metrics</li>
                                <li>Request clarification if ambiguous</li>
                            </ul>
                        </div>
                        <div class="code-block">
Output: {
    "banks": ["RBC", "TD", "BMO"],
    "periods": ["2024-Q3", "2024-Q2"],
    "intent": "revenue_comparison",
    "needs_clarification": false
}
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Stage 2: Planning</h3>
                        <p><strong>Agent:</strong> Planner | <strong>Model:</strong> Large tier for reasoning</p>
                        <div class="details">
                            <ul>
                                <li>Analyze clarified requirements</li>
                                <li>Select appropriate databases</li>
                                <li>Apply pairing rules (e.g., benchmarking+RTS for line items)</li>
                                <li>Generate execution plan</li>
                            </ul>
                        </div>
                        <div class="code-block">
Output: {
    "databases": ["benchmarking", "rts", "transcripts"],
    "query_focus": "Q3 2024 revenue metrics",
    "aggregation_strategy": "comparative"
}
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Stage 3: Concurrent Retrieval</h3>
                        <p><strong>Subagents:</strong> Database-specific agents | <strong>Model:</strong> Medium tier</p>
                        <div class="details">
                            <ul>
                                <li>Launch parallel threads for each database</li>
                                <li>Stream results as they arrive</li>
                                <li>Handle failures gracefully</li>
                                <li>Collect all responses in queue</li>
                            </ul>
                        </div>
                        
                        <div class="metrics" style="margin-top: 15px;">
                            <div class="agent-card">
                                <h4>Benchmarking</h4>
                                <p>Financial metrics and KPIs</p>
                            </div>
                            <div class="agent-card">
                                <h4>Reports</h4>
                                <p>Pre-generated analyses</p>
                            </div>
                            <div class="agent-card">
                                <h4>RTS</h4>
                                <p>Official filings</p>
                            </div>
                            <div class="agent-card">
                                <h4>Transcripts</h4>
                                <p>Earnings calls</p>
                            </div>
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Stage 4: Synthesis</h3>
                        <p><strong>Agent:</strong> Summarizer | <strong>Model:</strong> Large tier for synthesis</p>
                        <div class="details">
                            <ul>
                                <li>Aggregate results from all sources</li>
                                <li>Resolve conflicting information</li>
                                <li>Generate cohesive response</li>
                                <li>Stream output to user</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="warning-box">
                    <strong>Concurrency Note:</strong> All database subagents run in parallel threads with a shared queue for result collection, enabling real-time streaming as data becomes available.
                </div>
            </div>

            <!-- Direct Response Section -->
            <div class="section" id="direct">
                <h2>Direct Response Process</h2>
                
                <div class="agent-card">
                    <h4>Response Agent</h4>
                    <p><strong>Purpose:</strong> Generate immediate answers without database queries</p>
                    <p><strong>Model:</strong> Large tier for quality responses</p>
                    <p><strong>Use Cases:</strong> Greetings, definitions, clarifications, system info</p>
                </div>

                <div class="flow-diagram">
                    <h3>Direct Response Flow</h3>
                    
                    <div class="flow-step">
                        <h3>Input Processing</h3>
                        <p>Prepare context and conversation history</p>
                        <div class="code-block">
messages = [
    {"role": "system", "content": response_prompt},
    ...conversation_history,
    {"role": "user", "content": latest_message}
]
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Response Generation</h3>
                        <p>Stream response using OpenAI API</p>
                        <div class="code-block">
for chunk in stream(messages, context, model_tier="large"):
    yield {
        "type": "agent",
        "name": "aegis",
        "content": chunk
    }
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Completion</h3>
                        <p>Log metrics and return control</p>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Streaming:</strong> Direct responses use generator functions to provide real-time output, improving perceived performance and user experience.
                </div>
            </div>

            <!-- ETL Mode Section -->
            <div class="section" id="etl">
                <h2>ETL Direct Access Mode</h2>

                <div class="info-box">
                    <strong>Purpose:</strong> Bypass conversational flow for predetermined workflows, enabling batch processing and scheduled report generation with 80% reduction in LLM calls.
                </div>

                <div class="flow-diagram">
                    <h3>Conversational vs ETL Mode Comparison</h3>

                    <div class="branch">
                        <div class="branch-option">
                            <h4>Conversational Mode (5 LLM Calls)</h4>
                            <ol style="list-style: decimal; padding-left: 20px;">
                                <li>Router agent classification</li>
                                <li>Clarifier entity extraction</li>
                                <li>Planner database selection</li>
                                <li>Method selection (for transcripts)</li>
                                <li>Research synthesis generation</li>
                            </ol>
                        </div>
                        <div class="branch-option">
                            <h4>ETL Mode (1 LLM Call)</h4>
                            <ol style="list-style: decimal; padding-left: 20px;">
                                <li>Direct subagent access</li>
                                <li>Predetermined parameters</li>
                                <li>Custom prompt injection</li>
                                <li>Research synthesis only</li>
                                <li>Store results in database</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div class="flow-diagram">
                    <h3>ETL Implementation</h3>

                    <div class="flow-step">
                        <h3>Direct Function Access</h3>
                        <p>Import subagent functions directly without orchestration</p>
                        <div class="code-block">
from aegis.model.subagents.transcripts.retrieval import retrieve_full_section
from aegis.model.subagents.transcripts.formatting import generate_research_statement

# Direct access - no router/clarifier/planner needed
chunks = retrieve_full_section(combo, sections="ALL", context)
research = generate_research_statement(
    formatted_content=formatted,
    combo=combo,
    context=context,
    custom_prompt="Extract revenue metrics and growth rates"
)
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Command-Line Interface</h3>
                        <p>Structured parameters replace natural language queries</p>
                        <div class="code-block">
python -m aegis.etls.call_summary.main \
    --bank "Royal Bank of Canada" \
    --year 2024 \
    --quarter Q3 \
    --query "Extract all revenue metrics"
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Report Generation</h3>
                        <p>Store results for Aegis retrieval via Reports subagent</p>
                        <div class="details">
                            <ul>
                                <li>Generate structured reports</li>
                                <li>Save to database</li>
                                <li>Available via conversational mode</li>
                                <li>Schedule for regular updates</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="success-box">
                    <strong>Benefits:</strong> 80% LLM cost reduction, batch processing capability, scheduled report generation, custom extraction prompts, hybrid usage pattern.
                </div>
            </div>

            <!-- Monitoring Section -->
            <div class="section" id="monitoring">
                <h2>Monitoring & Tracking</h2>
                
                <div class="flow-diagram">
                    <h3>Comprehensive Execution Tracking</h3>
                    
                    <div class="flow-step">
                        <h3>Metrics Collection</h3>
                        <p>Every stage records detailed metrics</p>
                        <div class="code-block">
add_monitor_entry(
    stage_name="Clarification",
    stage_start_time=datetime.now(),
    stage_end_time=datetime.now(),
    status="Success",
    decision_details=json.dumps(clarifier_result),
    llm_calls=[{
        "model": "gpt-4.1-mini",
        "prompt_tokens": 500,
        "completion_tokens": 150,
        "total_tokens": 650
    }],
    custom_metadata={
        "banks_identified": 3,
        "periods_extracted": 2
    }
)
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Database Schema</h3>
                        <p>PostgreSQL process_monitor_logs table</p>
                        <div class="code-block">
CREATE TABLE process_monitor_logs (
    log_id SERIAL PRIMARY KEY,
    run_uuid UUID,
    model_name VARCHAR,
    stage_name VARCHAR,
    stage_start_time TIMESTAMP,
    stage_end_time TIMESTAMP,
    duration_ms INTEGER,
    status VARCHAR,
    decision_details TEXT,
    error_message TEXT,
    custom_metadata JSONB,
    total_tokens INTEGER,
    total_cost NUMERIC
);
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Cost Tracking</h3>
                        <p>Automatic token and cost calculation</p>
                        <div class="details">
                            <ul>
                                <li>Small tier: $0.075 / 1M tokens</li>
                                <li>Medium tier: $0.30 / 1M tokens</li>
                                <li>Large tier: $2.50 / 1M input, $10.00 / 1M output</li>
                            </ul>
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Performance Insights</h3>
                        <p>Query analysis and optimization data</p>
                        <div class="details">
                            <ul>
                                <li>Stage duration tracking</li>
                                <li>Bottleneck identification</li>
                                <li>Error pattern analysis</li>
                                <li>Usage statistics</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="success-box">
                    <strong>Benefits:</strong> Complete audit trail, performance optimization opportunities, cost management, debugging capabilities, and compliance documentation.
                </div>
            </div>

            <!-- Architecture Section -->
            <div class="section" id="architecture">
                <h2>System Architecture</h2>
                
                <div class="flow-diagram">
                    <h3>Layered Architecture Design</h3>
                    
                    <div class="agent-card">
                        <h4>Orchestration Layer</h4>
                        <p><strong>Location:</strong> src/aegis/model/</p>
                        <p><strong>Components:</strong> main.py, agents/, subagents/, prompts/</p>
                        <p><strong>Responsibility:</strong> Workflow coordination and agent management</p>
                    </div>

                    <div class="agent-card">
                        <h4>External Service Layer</h4>
                        <p><strong>Location:</strong> src/aegis/connections/</p>
                        <p><strong>Components:</strong> oauth_connector, llm_connector, postgres_connector</p>
                        <p><strong>Responsibility:</strong> External API and database integrations</p>
                    </div>

                    <div class="agent-card">
                        <h4>Foundation Layer</h4>
                        <p><strong>Location:</strong> src/aegis/utils/</p>
                        <p><strong>Components:</strong> settings, logging, ssl, conversation, monitor</p>
                        <p><strong>Responsibility:</strong> Core utilities and infrastructure</p>
                    </div>
                </div>

                <div class="flow-diagram">
                    <h3>Key Design Patterns</h3>
                    
                    <div class="flow-step">
                        <h3>Streaming Architecture</h3>
                        <p>Generator-based real-time data flow</p>
                        <div class="code-block">
def agent() -> Generator[Dict[str, str], None, None]:
    yield {"type": "agent", "name": "aegis", "content": "..."}
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Context Propagation</h3>
                        <p>Consistent context object throughout pipeline</p>
                        <div class="code-block">
context = {
    "execution_id": uuid,
    "auth_config": {...},
    "ssl_config": {...}
}
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Unified Message Schema</h3>
                        <p>Standard format across all components</p>
                        <div class="code-block">
{
    "type": "agent" | "subagent",
    "name": str,
    "content": str
}
                        </div>
                    </div>

                    <div class="flow-step">
                        <h3>Error Handling Strategy</h3>
                        <p>Graceful degradation with user feedback</p>
                        <div class="code-block">
try:
    # Operation
except Exception as e:
    logger.error(f"Error in {stage}: {e}")
    yield {"content": f"‚ö†Ô∏è Error: {e}"}
    # Continue with partial results
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Technology Stack:</strong> Python 3.8+, FastAPI, OpenAI API, PostgreSQL, SQLAlchemy, Structlog, Pytest
                </div>
            </div>
        </div>
    </div>

    <script>
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
    </script>
</body>
</html>