test_suite:
  name: "Clarifier Agent Test Suite"
  version: "1.0.0"
  description: "Test scenarios for the Clarifier agent - bank and period extraction"
  agent: "clarifier"
  created: "2024-08-24"
  
  # Performance thresholds for clarifier
  default_thresholds:
    max_latency_ms: 5000
    min_confidence: 0.8
    max_tokens: 500
    max_cost: 0.10
  
  scenarios:
    # 1. Clear bank and period specified
    - id: "clarifier_001"
      name: "Clear Bank and Period - RBC Q3 2024"
      description: "Test when bank and period are clearly specified"
      message: "Show me RBC's Q3 2024 financial results"
      expected:
        status: "success"
        bank_ids: [1]  # RBC bank_id
        period_year: 2024
        period_quarters: ["Q3"]
      reasoning: "RBC is clearly mentioned and Q3 2024 is explicitly specified"
      tags: ["bank_extraction", "period_extraction", "clear_query"]
    
    # 2. Multiple banks with single period
    - id: "clarifier_002"
      name: "Multiple Banks - Big Six Q2 2024"
      description: "Test extraction of category of banks with period"
      message: "Compare the Big Six banks performance in Q2 2024"
      expected:
        status: "success"
        bank_ids: [1, 2, 3, 4, 5, 6]  # All Big Six bank IDs (RBC, TD, BMO, Scotia, CIBC, National)
        period_year: 2024
        period_quarters: ["Q2"]
      reasoning: "Big Six is a recognized category and period is clear"
      tags: ["bank_category", "period_extraction", "multi_bank"]
    
    # 3. Ambiguous bank needs clarification
    - id: "clarifier_003"
      name: "Ambiguous Bank - No Period"
      description: "Test when bank reference is ambiguous and no period specified"
      message: "What are the latest financial metrics?"
      expected:
        status: "needs_clarification"
        needs_clarification: true
      reasoning: "Neither bank nor period is specified - needs full clarification"
      tags: ["needs_clarification", "ambiguous"]
    
    # 4. Bank clear but period needs clarification
    - id: "clarifier_004"
      name: "Clear Bank - Missing Period"
      description: "Test when bank is clear but period is missing"
      message: "Show me TD Bank's revenue"
      expected:
        status: "needs_clarification"
        bank_ids: [2]  # TD bank_id
        needs_clarification: true
      reasoning: "TD Bank is clear but no time period specified"
      tags: ["period_clarification", "partial_info"]
    
    # 5. Latest period inference
    - id: "clarifier_005"
      name: "Latest Period Request"
      description: "Test handling of 'latest' period request"
      message: "Give me BMO's latest quarterly results"
      expected:
        status: "success"
        bank_ids: [3]  # BMO bank_id
        period_year: 2025  # Latest available based on data
        period_quarters: ["Q3"]  # Latest Q3 2025 (Q4 not yet reported)
      reasoning: "BMO is clear and 'latest' should resolve to most recent reported quarter (Q3 2025 since we're in Q4)"
      tags: ["latest_period", "bank_extraction"]
    
    # 6. Year-to-date period
    - id: "clarifier_006"
      name: "YTD Period Request"
      description: "Test year-to-date period extraction"
      message: "Show Scotia's YTD 2025 performance"
      expected:
        status: "success"
        bank_ids: [4]  # Scotia bank_id (Bank of Nova Scotia)
        period_year: 2025
        period_quarters: ["Q1", "Q2", "Q3"]  # YTD only includes reported quarters (Q4 not yet reported)
      reasoning: "Scotia is clear and YTD 2025 includes only reported quarters Q1-Q3 (currently in Q4 FY2025)"
      tags: ["ytd_period", "bank_extraction"]
    
    # 7. Bank alias recognition
    - id: "clarifier_007"
      name: "Bank Alias - National Bank"
      description: "Test bank alias recognition"
      message: "What is National Bank's Q1 2024 net income?"
      expected:
        status: "success"
        bank_ids: [6]  # National Bank of Canada bank_id
        period_year: 2024
        period_quarters: ["Q1"]
      reasoning: "National Bank should be recognized and period is clear"
      tags: ["bank_alias", "period_extraction"]
    
    # 8. Multiple specific banks
    - id: "clarifier_008"
      name: "Multiple Specific Banks"
      description: "Test extraction of multiple specifically named banks"
      message: "Compare RBC and TD performance in Q4 2023"
      expected:
        status: "success"
        bank_ids: [1, 2]  # RBC and TD bank_ids
        period_year: 2023
        period_quarters: ["Q4"]
      reasoning: "Both banks are explicitly named and period is clear"
      tags: ["multi_bank", "specific_banks", "period_extraction"]
    
    # 9. Full year period
    - id: "clarifier_009"
      name: "Full Year Period"
      description: "Test full fiscal year period extraction"
      message: "Show CIBC's full year 2023 results"
      expected:
        status: "success"
        bank_ids: [5]  # CIBC bank_id (Canadian Imperial Bank of Commerce)
        period_year: 2023
        period_quarters: ["Q1", "Q2", "Q3", "Q4"]
      reasoning: "CIBC is clear and 'full year' means all quarters"
      tags: ["full_year", "bank_extraction"]
    
    # 10. Period clear but bank ambiguous
    - id: "clarifier_010"
      name: "Clear Period - Ambiguous Bank"
      description: "Test when period is clear but bank needs clarification"
      message: "What was the efficiency ratio in Q2 2024?"
      expected:
        status: "needs_clarification"
        needs_clarification: true
      reasoning: "Q2 2024 is clear but no bank specified"
      tags: ["bank_clarification", "partial_info"]
    
    # === BATCH 1: TEMPORAL EDGE CASES ===
    
    # 11. Ambiguous "recent" reference - should default to latest available
    - id: "clarifier_011"
      name: "Recent Performance Request"
      description: "Test 'recent' temporal reference defaults to latest"
      message: "Show me TD's recent performance"
      expected:
        status: "success"
        bank_ids: [2]  # TD
        period_year: 2025
        period_quarters: ["Q3"]  # Latest available
      reasoning: "'Recent' reasonably defaults to latest reported quarter (Q3 2025)"
      tags: ["temporal_inference", "default_latest"]
    
    # 12. Future period request
    - id: "clarifier_012"
      name: "Future Period Request"
      description: "Test detection of future-dated periods"
      message: "What will RBC's Q1 2026 results be?"
      expected:
        status: "needs_clarification"
        bank_ids: [1]  # RBC identified
        needs_clarification: true
      reasoning: "RBC is clear but Q1 2026 is future-dated and not available"
      tags: ["future_period", "period_clarification"]
    
    # 13. "Last year" reference - ambiguous
    - id: "clarifier_013"
      name: "Ambiguous Last Year"
      description: "Test ambiguous 'compare last year' request"
      message: "Compare BMO's last year performance"
      expected:
        status: "needs_clarification"
        bank_ids: [3]  # BMO
        needs_clarification: true
      reasoning: "Ambiguous - could mean FY2024 standalone or compare FY2024 vs FY2023"
      tags: ["temporal_ambiguity", "comparison"]
    
    # 14. Quarter-over-quarter request
    - id: "clarifier_014"
      name: "QoQ Growth Request"
      description: "Test quarter-over-quarter defaults to latest two quarters"
      message: "Show Scotia's QoQ growth"
      expected:
        status: "success"
        bank_ids: [4]  # Scotia
        period_year: 2025
        period_quarters: ["Q2", "Q3"]  # Latest two quarters
      reasoning: "QoQ defaults to Q3 2025 vs Q2 2025 (latest reported and prior)"
      tags: ["qoq", "temporal_inference"]
    
    # 15. "This quarter" request (current unreported)
    - id: "clarifier_015"
      name: "Current Quarter Unreported"
      description: "Test handling of current but unreported quarter"
      message: "How is CIBC doing this quarter?"
      expected:
        status: "needs_clarification"
        bank_ids: [5]  # CIBC
        needs_clarification: true
      reasoning: "This quarter (Q4 2025) hasn't been reported yet"
      tags: ["current_quarter", "unreported_period"]
    
    # 16. Trailing twelve months
    - id: "clarifier_016"
      name: "TTM Request"
      description: "Test trailing twelve months period extraction"
      message: "RBC's TTM revenue"
      expected:
        status: "success"
        bank_ids: [1]  # RBC
        # TTM spans two fiscal years
        period_years: [2024, 2025]
        period_quarters_2024: ["Q4"]
        period_quarters_2025: ["Q1", "Q2", "Q3"]
      reasoning: "TTM resolves to last 4 reported quarters: Q4 2024, Q1-Q3 2025"
      tags: ["ttm", "multi_quarter"]
    
    # 17. "Since" temporal reference
    - id: "clarifier_017"
      name: "Since Temporal Reference"
      description: "Test 'since' with specific start period"
      message: "TD's performance since Q1 2024"
      expected:
        status: "success"
        bank_ids: [2]  # TD
        # Range spans two fiscal years
        period_years: [2024, 2025]
        period_quarters_2024: ["Q1", "Q2", "Q3", "Q4"]
        period_quarters_2025: ["Q1", "Q2", "Q3"]
      reasoning: "Since Q1 2024 means from Q1 2024 to latest (Q3 2025)"
      tags: ["temporal_range", "since"]
    
    # 18. Comparison across fiscal years
    - id: "clarifier_018"
      name: "Cross-Year Comparison"
      description: "Test explicit comparison between two fiscal years"
      message: "Compare National Bank Q4 2024 vs Q4 2023"
      expected:
        status: "success"
        bank_ids: [6]  # National Bank
        period_years: [2023, 2024]
        period_quarters_2023: ["Q4"]
        period_quarters_2024: ["Q4"]
      reasoning: "Clear comparison between two specific quarters"
      tags: ["comparison", "multi_year"]
    
    # 19. "Previous quarter" reference
    - id: "clarifier_019"
      name: "Previous Quarter Request"
      description: "Test 'previous quarter' resolves to latest reported"
      message: "BMO's previous quarter results"
      expected:
        status: "success"
        bank_ids: [3]  # BMO
        period_year: 2025
        period_quarters: ["Q3"]
      reasoning: "Previous quarter = Q3 2025 (latest reported)"
      tags: ["relative_period", "previous_quarter"]
    
    # 20. Month reference (banks report quarterly)
    - id: "clarifier_020"
      name: "Monthly to Quarterly Mapping"
      description: "Test handling of month when banks report quarterly"
      message: "Show me RBC's June performance"
      expected:
        status: "needs_clarification"
        bank_ids: [1]  # RBC
        needs_clarification: true
      reasoning: "Banks report quarterly - June would be Q3, but needs clarification"
      tags: ["month_to_quarter", "period_clarification"]
    
    # === BATCH 2: BANK ENTITY CHALLENGES ===
    
    # 21. Partial bank name
    - id: "clarifier_021"
      name: "Partial Bank Name"
      description: "Test partial bank name recognition"
      message: "Show Royal's Q2 2024 metrics"
      expected:
        status: "success"
        bank_ids: [1]  # RBC (Royal Bank)
        period_year: 2024
        period_quarters: ["Q2"]
      reasoning: "'Royal' clearly refers to Royal Bank of Canada in this context"
      tags: ["partial_match", "bank_extraction"]
    
    # 22. Bank nickname/informal reference
    - id: "clarifier_022"
      name: "Informal Bank Reference"
      description: "Test ambiguous informal bank reference"
      message: "How did the green bank do last quarter?"
      expected:
        status: "needs_clarification"
        needs_clarification: true
      reasoning: "'Green bank' is ambiguous - could be TD (green logo) or sustainability-focused"
      tags: ["informal_reference", "bank_clarification"]
    
    # 23. Multiple banks with "and"
    - id: "clarifier_023"
      name: "Multiple Banks Listed"
      description: "Test extraction of multiple explicitly named banks"
      message: "Compare RBC, TD, and BMO for Q1 2025"
      expected:
        status: "success"
        bank_ids: [1, 2, 3]  # RBC, TD, BMO
        period_year: 2025
        period_quarters: ["Q1"]
      reasoning: "Three banks explicitly named with clear period"
      tags: ["multi_bank", "explicit_list"]
    
    # 24. Category minus specific banks
    - id: "clarifier_024"
      name: "Category With Exclusion"
      description: "Test bank category with explicit exclusion"
      message: "Big Six except National Bank Q3 2024"
      expected:
        status: "success"
        bank_ids: [1, 2, 3, 4, 5]  # All Big Six except NBC (6)
        period_year: 2024
        period_quarters: ["Q3"]
      reasoning: "Big Six category with explicit exclusion of NBC"
      tags: ["category", "exclusion"]
    
    # 25. Bank by ranking/position
    - id: "clarifier_025"
      name: "Bank by Ranking"
      description: "Test ambiguous ranking reference"
      message: "The largest Canadian bank's latest results"
      expected:
        status: "needs_clarification"
        needs_clarification: true
      reasoning: "'Largest' is ambiguous - by assets, market cap, or revenue?"
      tags: ["ranking", "bank_clarification"]
    
    # 26. Typo in bank name
    - id: "clarifier_026"
      name: "Bank Name Typo"
      description: "Test handling of typo in bank name"
      message: "Show me Scottia's YTD performance"
      expected:
        status: "success"
        bank_ids: [4]  # Scotia
        period_year: 2025
        period_quarters: ["Q1", "Q2", "Q3"]
      reasoning: "'Scottia' is clearly a typo for Scotia"
      tags: ["typo_handling", "bank_extraction"]
    
    # 27. Bank by abbreviation only
    - id: "clarifier_027"
      name: "Bank Abbreviations"
      description: "Test recognition of bank abbreviations"
      message: "BMO vs TD Q4 2024"
      expected:
        status: "success"
        bank_ids: [3, 2]  # BMO and TD
        period_year: 2024
        period_quarters: ["Q4"]
      reasoning: "Clear abbreviations for both banks"
      tags: ["abbreviation", "multi_bank"]
    
    # 28. Non-existent bank
    - id: "clarifier_028"
      name: "Non-Existent Bank"
      description: "Test handling of bank not in system"
      message: "Wells Fargo's Canadian operations Q2 2025"
      expected:
        status: "needs_clarification"
        needs_clarification: true
      reasoning: "Wells Fargo not in our Canadian bank list"
      tags: ["invalid_bank", "bank_clarification"]
    
    # 29. All banks request
    - id: "clarifier_029"
      name: "All Banks Request"
      description: "Test 'all banks' resolves to full list"
      message: "Show all banks Q3 2024 efficiency ratios"
      expected:
        status: "success"
        bank_ids: [1, 2, 3, 4, 5, 6]  # All available banks
        period_year: 2024
        period_quarters: ["Q3"]
      reasoning: "'All banks' means all available in the system"
      tags: ["all_banks", "category"]
    
    # 30. Pronouns referring to banks
    - id: "clarifier_030"
      name: "Pronoun Without Antecedent"
      description: "Test pronoun with no clear antecedent"
      message: "What were their results?"
      expected:
        status: "needs_clarification"
        needs_clarification: true
      reasoning: "'Their' has no antecedent - needs clarification"
      tags: ["pronoun", "bank_clarification"]